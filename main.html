<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ğŸ“¸ GalerÃ­a</title>
  <link href="https://fonts.googleapis.com/css2?family=EB+Garamond&family=Inter:wght@400;600&display=swap" rel="stylesheet" />
  <style>
    /* (Todo tu CSS actual permanece igual, ya estÃ¡ muy bien diseÃ±ado) */
  </style>
</head>
<body>
  <div class="rainbow-bar animated"></div>

  <nav class="menu">
    <a href="acerca.html">â„¹ï¸ Acerca</a>
    <a href="condiciones.html">ğŸ“œ TÃ©rminos</a>
    <a href="ayuda.html">â“ Ayuda</a>
    <a href="privacidad.html">ğŸ”’ Privacidad</a>
    <button id="logout-btn">ğŸšª Salir</button>
  </nav>

  <main>
    <h1>MomentosğŸ“·</h1>
    <div id="mensaje" class="mensaje"></div>

    <form id="image-upload-form">
      <label for="image">Selecciona imagen:</label>
      <input type="file" id="image" accept="image/*" required />
      <button type="submit">Subir ğŸ“¤</button>
    </form>

    <section id="gallery" class="gallery"></section>
  </main>

  <script src="auth.js"></script>
  <script>
    async function cargarImagenes(token) {
      const res = await fetch('https://tu-backend.com/api/imagenes', {
        headers: { Authorization: 'Bearer ' + token }
      });
      if (!res.ok) throw new Error('No autorizado');
      const imagenes = await res.json();
      const galeria = document.getElementById('gallery');
      galeria.innerHTML = ''; // Limpia la galerÃ­a

      imagenes.forEach(img => {
        const tarjeta = document.createElement('div');
        tarjeta.style.border = "1px solid #ccc";
        tarjeta.style.borderRadius = "8px";
        tarjeta.style.padding = "0.5rem";
        tarjeta.style.background = "#fff";
        tarjeta.style.display = "flex";
        tarjeta.style.flexDirection = "column";
        tarjeta.style.alignItems = "center";

        const imagen = document.createElement('img');
        imagen.src = img.url;
        imagen.alt = 'Imagen subida';
        imagen.style.width = "100%";
        imagen.style.borderRadius = "6px";

        const texto = document.createElement('p');
        texto.textContent = `${img.usuario} â€¢ ${new Date(img.timestamp).toLocaleString()}`;
        texto.style.fontSize = "0.8rem";
        texto.style.marginTop = "0.4rem";

        const eliminarBtn = document.createElement('button');
        eliminarBtn.textContent = 'ğŸ—‘ï¸ Eliminar';
        eliminarBtn.style.marginTop = "0.5rem";
        eliminarBtn.style.fontSize = "0.8rem";
        eliminarBtn.style.cursor = "pointer";
        eliminarBtn.onclick = async () => {
          if (confirm("Â¿Eliminar esta imagen?")) {
            const delRes = await fetch(`https://tu-backend.com/api/imagenes/${img._id}`, {
              method: 'DELETE',
              headers: { Authorization: 'Bearer ' + token }
            });
            if (delRes.ok) {
              tarjeta.remove();
            } else {
              alert("No se pudo eliminar.");
            }
          }
        };

        tarjeta.appendChild(imagen);
        tarjeta.appendChild(texto);
        tarjeta.appendChild(eliminarBtn);
        galeria.appendChild(tarjeta);
      });
    }

    document.addEventListener('DOMContentLoaded', async () => {
      const valid = await asegurarSesion();
      if (!valid) return;

      const token = localStorage.getItem('token');
      try {
        await cargarImagenes(token);
      } catch (e) {
        console.error(e);
        localStorage.removeItem('token');
        window.location.href = 'login.html';
      }

      // Subida de imagen
      document.getElementById('image-upload-form').addEventListener('submit', async e => {
        e.preventDefault();
        const archivo = document.getElementById('image').files[0];
        if (!archivo) return alert("Selecciona una imagen.");

        const formData = new FormData();
        formData.append('imagen', archivo);

        const res = await fetch('https://tu-backend.com/api/imagenes', {
          method: 'POST',
          headers: {
            Authorization: 'Bearer ' + token
          },
          body: formData
        });

        if (res.ok) {
          document.getElementById('mensaje').textContent = "Imagen subida âœ…";
          document.getElementById('image').value = '';
          await cargarImagenes(token);
        } else {
          document.getElementById('mensaje').textContent = "Error al subir imagen âŒ";
        }
      });

      // Salir
      document.getElementById('logout-btn').addEventListener('click', () => {
        localStorage.removeItem('token');
        window.location.href = 'login.html';
      });
    });
  </script>
</body>
</html>

      });
    });
  </script>
</body>
</html>
